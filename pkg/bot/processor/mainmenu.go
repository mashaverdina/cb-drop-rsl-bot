package processor

import (
	"context"

	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"

	chatutils "vkokarev.com/rslbot/pkg/chat_utils"
	"vkokarev.com/rslbot/pkg/entities"
	"vkokarev.com/rslbot/pkg/keyboards"
	"vkokarev.com/rslbot/pkg/messages"
)

type MainProcessor struct{}

func (p *MainProcessor) Handle(ctx context.Context, state entities.UserState, msg *ProcessingMessage) (entities.UserState, []tgbotapi.Chattable, error) {
	switch msg.Text {
	case messages.Cb5:
		state.State = entities.StateCb5
		resp := chatutils.TextTo(msg, "–ß—Ç–æ —É–ø–∞–ª–æ —Å 5–≥–æ –ö–ë?", keyboards.AddDropInlineKeyboard)
		return state, resp, nil
	case messages.Cb6:
		state.State = entities.StateCb6
		resp := chatutils.TextTo(msg, "–ß—Ç–æ —É–ø–∞–ª–æ —Å 6–≥–æ –ö–ë?", keyboards.AddDropInlineKeyboard)
		return state, resp, nil
	case messages.Stats:
		state.State = entities.StateStats
		resp := chatutils.TextTo(msg, "–ß—Ç–æ —Ç–µ–±–µ –ø–æ–∫–∞–∑–∞—Ç—å?", keyboards.StatsKeyboard)
		return state, resp, nil
	case messages.Help:
		text := "–ü—Ä–∏–≤–µ—Ç!ü§ñ\n" +
			"–ï—Å–ª–∏ —Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å –≤–∏–¥–µ–æ-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Ç–æ –ø–æ—Å–º–æ—Ç—Ä–∏ —Ä–æ–ª–∏–∫ –æ–±–æ –º–Ω–µ –Ω–∞ [–∫–∞–Ω–∞–ª–µ LesiQ](https://www.youtube.com/watch?v=Va27Po7mmkU), –∞ –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ ‚Äì –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–π –¥–∞–ª—å—à–µ.\n\n" +
			"–Ø –±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–≤–æ–µ–≥–æ –¥—Ä–æ–ø–∞ —Å –ö–ë –≤ Raid SL.\n" +
			"–ï—Å–ª–∏ —Ç—ã –∑–∞–±–∏—Ä–∞–µ—à—å *2 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö* —Å—É–Ω–¥—É–∫–∞ —Å *5 –∏/–∏–ª–∏ 6* –∫–ª–∞–Ω –±–æ—Å—Å–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–π –º–Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ–µ–º –¥—Ä–æ–ø–µ, –∏ —è –∑–∞–ø–æ–º–Ω—é –µ–µ –¥–ª—è —Ç–µ–±—è. –ê –µ—â–µ –ø–æ–∫–∞–∂—É —Ç–µ–±–µ —Ä–∞–∑–Ω—É—é –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.\n" +
			"–ü–æ–∫–∞ —á—Ç–æ *—è —É–º–µ—é* –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å\n" +
			"  ‚Äì —Ç–≤–æ–π –¥—Ä–æ–ø –∑–∞ –º–µ—Å—è—Ü,\n" +
			"  ‚Äì –¥–∞—Ç—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–∞–∫—Ä–∞–ª–∞, –≤–æ–π–¥–∞ –∏ –ª–µ–≥ —Ç–æ–º–∞.\n" +
			"–ù–æ —Å–æ–≤—Å–µ–º *—Å–∫–æ—Ä–æ —è —Å–º–æ–≥—É*\n" +
			"  ‚Äì —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–π –¥—Ä–æ–ø –≤ Excel —Ñ–∞–π–ª,\n" +
			"  ‚Äì –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —à–∞–Ω—Å—ã –¥—Ä–æ–ø–∞,\n" +
			"  ‚Äì —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–±–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã —É–¥–∞—á–ª–∏–≤(–∞) –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Å–æ–∫–ª–∞–Ω–∞–º–∏ –∏ –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.\n" +
			"–¢—ã –º–æ–∂–µ—à—å –ø—Ä–∏—Å–ª–∞—Ç—å —Å–≤–æ–∏ –∏–¥–µ–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é [–º–æ–µ–º—É –±–æ—Ç—é–Ω–µ](https://t.me/rsl_cb_drop_support_bot).\n\n" +
			"–ê –¥–∞–ª—å—à–µ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ *—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã*\n\n" +
			"*–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–π –¥—Ä–æ–ø?*\n" +
			"1. –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É _\"üòà/üëπ –î–æ–±–∞–≤–∏—Ç—å –¥—Ä–æ–ø —Å 5/6 –ö–ë\"_.\n" +
			"2. –ù–∞–∂–∏–º–∞—è –Ω–∞ _–∫–Ω–æ–ø–∫–∏ –æ—Å–∫–æ–ª–∫–æ–≤ –∏ —Ç–æ–º–æ–≤_ (üíôüíúüíõüìòüìô), –Ω–∞–±–µ—Ä–∏ —Å–≤–æ–π –¥—Ä–æ–ø. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –Ω–∞–¥ –∫–Ω–æ–ø–∫–∞–º–∏. –ù–∞ –∫–Ω–æ–ø–∫–∏ –º–æ–∂–Ω–æ –Ω–∞–∂–∏–º–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –≤–≤–µ–ª–æ—Å—å –Ω–µ–≤–µ—Ä–Ω–æ, –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É _\"üîÑ –ó–∞–Ω–æ–≤–æ\"_.\n" +
			"3. –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É _\"‚úÖ –û–ö\"_.\n" +
			"‚ö†Ô∏è –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥—Ä–æ–ø –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ –ø–æ–ª—É–Ω–æ—á–∏ –ø–æ –ú–°–ö, –∏–Ω–∞—á–µ –æ–Ω –∑–∞–ø–∏—à–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.\n\n" +
			"*–î–æ–±–∞–≤–∏–ª(–∞) —á—Ç–æ-—Ç–æ –Ω–µ —Ç–æ, —á—Ç–æ –¥–µ–ª–∞—Ç—å?*\n" +
			"‚Äì –ï—Å–ª–∏ —Ç—ã –µ—â–µ –Ω–µ –Ω–∞–∂–∞–ª(–∞) –Ω–∞ –∫–Ω–æ–ø–∫—É _\"‚úÖ –û–ö\"_, —Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É _\"üîÑ –ó–∞–Ω–æ–≤–æ\"_ –∏ —Å–Ω–æ–≤–∞ –≤–≤–µ–¥–∏ –¥—Ä–æ–ø.\n" +
			"‚Äì –ï—Å–ª–∏ —Ç—ã —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ, —Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–Ω–æ–≤–∞ –æ—Ç–ø—Ä–∞–≤—å –¥—Ä–æ–ø, –∏ –æ–Ω –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Å—Ç–∞—Ä—ã–π.\n" +
			"‚ö†Ô∏è –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥—Ä–æ–ø –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ –ø–æ–ª—É–Ω–æ—á–∏ –ø–æ –ú–°–ö.\n\n" +
			"*–ú–Ω–µ –Ω–∏—á–µ–≥–æ –Ω–µ —É–ø–∞–ª–æ —Å 5 –∫–±, —á—Ç–æ –¥–µ–ª–∞—Ç—å?*\n" +
			"_–ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—É—Å—Ç–æ–π –¥—Ä–æ–ø –≤–∞–∂–Ω–æ, —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –º–Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É._" +
			"1. –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É _\"üòà –î–æ–±–∞–≤–∏—Ç—å –¥—Ä–æ–ø —Å 5 –ö–ë\"_.\n" +
			"2. –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É _\"‚úÖ –û–ö\"_.\n\n" +
			"*–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å –¥—Ä–æ–ø –∑–∞ –≤—á–µ—Ä–∞ (–Ω–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥, 01.01.200)?*\n" +
			"–ù–∏–∫–∞–∫. –î—Ä–æ–ø –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É, –ø—Ä–∏—á–µ–º –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–Ω–æ—á—å –ø–æ –ú–°–ö.\n\n" +
			"*–Ø –±—å—é 1/2/3/4 –ö–ë, –∫—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–π –¥—Ä–æ–ø?*\n" +
			"–ù–∏–∫—É–¥–∞. –ü–æ –º–æ–∏–º —Ä–∞—Å—á–µ—Ç–∞–º, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ –∏–≥—Ä–æ–∫–∏ —É–∂–µ —Å–ø—É—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ –Ω–∞—á–∏–Ω–∞—é—Ç –±–∏—Ç—å 5–≥–æ –ö–ë. –Ø —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —É —Ç–µ–±—è –≤—Å–µ –ø–æ–ª—É—á–∏—Ç—Å—è, –∏ —á—Ç–æ –º—ã —É–≤–∏–¥–∏–º—Å—è —Å–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ!\U0001F9BE\n\n" +
			"*–•–æ—á—É –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–∞–∫—Ä–∞–ª—ã (–ª–µ–≥ —Ç–æ–º–∞, ...), —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å—É–Ω–¥—É–∫, —Ç–∞–∫ –º–æ–∂–Ω–æ?*\n" +
			"–î–∞, —Ç–∞–∫ –º–æ–∂–Ω–æ. –ù–æ —Å–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ —è –Ω–∞—É—á—É—Å—å —Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–Ω—É—é –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—à–∞–Ω—Å –¥—Ä–æ–ø–∞, —Ç–≤–æ—é —É–¥–∞—á–ª–∏–≤–æ—Å—Ç—å,...) —Å —É—á–µ—Ç–æ–º —Ç–æ–≥–æ, —á—Ç–æ –≤—Å–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –≤–µ—Å—å –¥—Ä–æ–ø –∏–∑ 2 —Å—É–Ω–¥—É–∫–æ–≤. –ß–µ–º –±–æ–ª—å—à–µ –ª—é–¥–µ–π –¥–µ–ª–∞—é—Ç –∏–Ω–∞—á–µ, —Ç–µ–º –º–µ–Ω–µ–µ —Ç–æ—á–Ω–æ–π –ø–æ–ª—É—á–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.\n\n" +
			"–ï—Å–ª–∏ —É —Ç–µ–±—è –æ—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–ø–∏—à–∏ [–º–æ–µ–º—É –±–æ—Ç—é–Ω–µ](https://t.me/rsl_cb_drop_support_bot).\n"
		resp := chatutils.TextTo(msg, text, keyboards.MainMenuKeyboard)
		return state, resp, nil
	default:
		return state, nil, UnknownResuest
	}
}

func (p *MainProcessor) CanHandle(msg *ProcessingMessage) bool {
	switch msg.Text {
	case messages.Cb5, messages.Cb6, messages.Stats, messages.Help:
		return true
	default:
		return false
	}
}

func (p *MainProcessor) CancelFor(userID int64) {
}
